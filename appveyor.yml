environment:

  matrix:
    - TARGET_ARCH: x86
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda35
      CONDA_PY: 35

    - TARGET_ARCH: x64
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda35-x64
      CONDA_PY: 35

    - TARGET_ARCH: x86
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda36
      CONDA_PY: 36

    - TARGET_ARCH: x64
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda36-x64
      CONDA_PY: 36

    - TARGET_ARCH: x86
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda37
      CONDA_PY: 37

    - TARGET_ARCH: x64
      CONDA_NPY: 115
      CONDA_INSTALL_LOCN: C:\\Miniconda37-x64
      CONDA_PY: 37

platform:
  - x64

os: 
  - Visual Studio 2015
  - Visual Studio 2017

init:
  - "ECHO %CONDA_INSTALL_LOCN% %CONDA_PY% %HOME% %PLATFORM%"
  - "ECHO %APPVEYOR_REPO_BRANCH%"

install:
  - cmd: call %CONDA_INSTALL_LOCN%\Scripts\activate.bat
  - cmd: conda update --yes --quiet conda
  - cmd: set PYTHONUNBUFFERED=1
  - cmd: conda info
  - cmd: conda config --set always_yes yes
  - cmd: conda update -q conda
  - cmd: conda create -q -n test-environment python=%PYTHON_VERSION%
  - cmd: activate test-environment
  - cmd: conda install -q numpy scipy matplotlib shapely pytest
  - cmd: conda install -q -c conda-forge pytest-mpl
  - cmd: conda list

build: false

test_script:
  - py.test --mpl --mpl-results-path=tests/results

after_test:
  - cmd: pip install twine
  - cmd: python setup.py bdist_wheel

artifacts:
  # Archive the generated conda package in the ci.appveyor.com build report.
  - path: 'dist\*'

# deploy_script:
#   - cmd: conda install -q conda-build anaconda-client
#   - cmd: python .ci/appveyor/anaconda_build.py
#   - cmd: python .ci/appveyor/anaconda_upload.py
#   - cmd: python .ci/appveyor/pypi_upload.py

deploy_script:
  - echo "Starting Deployment"
  # upload conda builds to conda cloud
  - cmd: set PATH=%PYTHON%;%PYTHON%\Scripts;%PYTHON%\Library\bin;%PATH%
  - echo %APPVEYOR_REPO_TAG%
  - ps: If ($env:APPVEYOR_REPO_TAG -eq "true") { $env:conda_upload = 'true' } Else { write-output "Not on a tag, won't deploy to anaconda" }
  - cmd: IF "%conda_upload%"=="true" anaconda -t %CONDA_TOKEN% upload %PYTHON%\\conda\\win-*\\*.tar.bz2 -u sededu --no-progress --force